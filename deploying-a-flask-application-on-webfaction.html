<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link rel="stylesheet" type="text/css" href="https://raichev.net/theme/fonts/medium-fonts.css" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>    Alex Raichev > Blog > Deploying a Flask Application on Webfaction
</title>
    <link href="https://raichev.net/theme/css/style.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="https://raichev.net/theme/css/pygment.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="https://raichev.net/" type="application/atom+xml" rel="alternate" title="Alex Raichev ATOM Feed" />
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
    styles: {
    ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
    },
    // tex2jax: {inlineMath: [['%','$'], ['\\(','\\)']],processEscapes: true}
    tex2jax: {inlineMath: [['\\(','\\)']],processEscapes: true}
    });
    MathJax.Hub.Register.StartupHook("HTML-CSS Jax Ready",function () {
    var VARIANT = MathJax.OutputJax["HTML-CSS"].FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
    MathJax.Hub.Register.StartupHook("SVG Jax Ready",function () {
    var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;
    VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
    VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
    VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
    VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
    });
</script>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>    <meta charset="utf-8">

<body>
    <header>
      <h1>Alex Raichev</h1>
      <span id="graph"></span>
    </header>

    <nav>
<ul>
          <li><a href="/index.html"
>Welcome</a></li>
<li>&middot;<li>          <li><a href="/pages/works.html"
>Works</a></li>
<li>&middot;<li>          <li><a href="/blog.html"
              class="active"
>Blog</a></li>
<li>&middot;<li>          <li><a href="/archives.html"
>Blogindex</a></li>
      </ul>
    </nav>

    <div id="mainContent">
 
  <div class="blogItem">
    <h1>Deploying a Flask Application on Webfaction</h1>
    <p>A few months ago i had to deploy for the first time a Flask application on a Webfaction server.
After studying <a class="reference external" href="https://community.webfaction.com/questions/12718/installing-flask?page=1&amp;focusedAnswerId=12719#12719">this Webfaciton Community thread</a> on the topic, issuing a Webfaction support ticket for help ---Webfaction customer service is excellent--- and trying and failing several times, i figured it out.
Here's what i did.</p>
<p>Suppose that your Flask project structure looks like this:</p>
<pre class="literal-block">
APPNAME
├── APPNAME
│&nbsp;&nbsp; ├── main.py
│&nbsp;&nbsp; ...
│&nbsp;&nbsp; └── wsgi.py
...
├── Pipfile
├── Pipfile.lock
└── README.rst
</pre>
<p>that you are tracking it with Git, that you run it locally in a Python virtual environment, e.g. using Pipenv, and that it works.
Now, let's deploy it to Webfaction.</p>
<ol class="arabic">
<li><p class="first">Log in to your Webfaction control panel and create a new mod_wsgi/Python application. Also create a corresponding domain and website for the app. I assume you know how to do that.</p>
</li>
<li><p class="first">Throughout the remainder of these notes, suppose that your Webfaction username is USERNAME and that your Flask application is called APPNAME</p>
</li>
<li><p class="first">SSH into your Webfaction server and run these commands:</p>
<pre class="literal-block">
&gt; mkdir home/USERNAME/webapps/APPNAME/APPNAME
&gt; rm -r home/USERNAME/webapps/APPNAME/htdocs
&gt; rm -r home/USERNAME/webapps/APPNAME/lib
</pre>
<p>You don't need the <tt class="docutils literal">lib</tt> directory in the last line, because you will be using a virtual environment.</p>
</li>
<li><p class="first">Set up Git, Git hooks, and push your local repository to Webfaction. See the Webfaction instructions <a class="reference external" href="https://docs.webfaction.com/software/git.html">here</a> and <a class="reference external" href="https://community.webfaction.com/questions/1246/using-git-with-applications">here</a>.</p>
</li>
<li><p class="first">Create your virtual environment ---let's call it VENVNAME here--- and install your app requirements. I think the easiest way to do this is to install Pip to install Pipenv to manage your virtual environments and packages.</p>
</li>
<li><p class="first">If your local repo has a <tt class="docutils literal">.env</tt> environment file containing (Git-ignored) secrets, then create a corresponding <tt class="docutils literal">.env</tt> file in your Webfaction repo.</p>
</li>
<li><p class="first">If you haven't done so already, create the file <tt class="docutils literal">home/USERNAME/webapps/APPNAME/APPNAME/wsgi.py</tt> containing the single line <tt class="docutils literal">from main import server as application</tt>.</p>
<p>This assumes that your Flask code lies in the module <tt class="docutils literal">main.py</tt> and that the Flask app you create in that module is call <tt class="docutils literal">server</tt>.
If that's not the case, then change the above snippet as needed.</p>
</li>
<li><p class="first">Edit the file <tt class="docutils literal">home/USERNAME/webapps/APPNAME/apache2/conf/httpd.conf</tt> to the following, where PORT is the port number that Webfaction assigned to your application (which you can view in your Webfaction control panel for the app):</p>
<pre class="literal-block">
ServerRoot &quot;/home/USERNAME/webapps/APPNAME/apache2&quot;

LoadModule authz_core_module modules/mod_authz_core.so
LoadModule dir_module        modules/mod_dir.so
LoadModule env_module        modules/mod_env.so
LoadModule log_config_module modules/mod_log_config.so
LoadModule mime_module       modules/mod_mime.so
LoadModule rewrite_module    modules/mod_rewrite.so
LoadModule setenvif_module   modules/mod_setenvif.so
LoadModule wsgi_module       modules/mod_wsgi.so
LoadModule unixd_module      modules/mod_unixd.so

LogFormat &quot;%{X-Forwarded-For}i %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
CustomLog /home/USERNAME/logs/user/access_APPNAME.log combined
ErrorLog /home/USERNAME/logs/user/error_APPNAME.log

Listen PORT
KeepAlive Off
SetEnvIf X-Forwarded-SSL on HTTPS=1
ServerLimit 1
StartServers 1
MaxRequestWorkers 5
MinSpareThreads 1
MaxSpareThreads 3
ThreadsPerChild 5

WSGIPythonHome /home/USERNAME/.virtualenvs/VENVNAME
WSGIDaemonProcess APPNAME processes=2 threads=12 python-path=/home/USERNAME/webapps/APPNAME/APPNAME:/home/USERNAME/webapps/APPNAME/APPNAME/APPNAME
WSGIScriptAlias / /home/USERNAME/webapps/APPNAME/APPNAME/APPNAME/wsgi.py
WSGIProcessGroup APPNAME
WSGIRestrictEmbedded On
WSGILazyInitialization On
</pre>
</li>
<li><p class="first">Restart your app via <tt class="docutils literal">home/USERNAME/webapps/APPNAME/apache2/bin/restart</tt>.</p>
</li>
</ol>
<p>These instructions will probably go obsolete in a few months, as all things web related do.
Still, they'll help me while they last and maybe help you too.</p>
	

    <div class="blogMeta">        
      Author: Alex Raichev<br />
      Date: 2018-05-17<br />
        Tags:
          <span><a href="https://raichev.net/tag/instructions.html">
          instructions</a>, </span>
          <span><a href="https://raichev.net/tag/tech.html">
          tech</a></span>
<br />
      <a href="mailto:alex@raichev.net?subject=comment on https://raichev.net/deploying-a-flask-application-on-webfaction.html">Comment</a>
    </div>
  </div>

  <!--    <p>There are no comments yet.<p>
-->
    </div>

    <div class="clearfloat"></div>

    <div id="footer">
      <p>Powered by <a href="http://getpelican.com">Pelican</a>
    </div>

  <script src="/js/d3.v3.min.js"></script>
  <script src="/js/graph.js"></script>
  <script src="/js/jquery.v2.1.3.min.js"></script>
  <script src="/js/video.js"></script>


  <!-- Piwik -->
  <script type="text/javascript">
    var _paq = _paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//piwik.mrcagney.works/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>




</body>
</html>